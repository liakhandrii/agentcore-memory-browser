<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ§  AgentCore Memory Browser</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
    <!-- JSONEditor CSS -->
    <link href="https://cdn.jsdelivr.net/npm/jsoneditor@9.10.2/dist/jsoneditor.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="/static/css/styles.css?v={{ cache_bust_uuid }}" rel="stylesheet">
</head>
<body class="bg-light">
    <!-- Navigation -->
    <nav class="navbar navbar-dark bg-primary shadow-sm">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="bi bi-brain me-2"></i>
                AgentCore Memory Browser
            </span>
            <div class="d-flex align-items-center">
                <button class="btn btn-outline-light btn-sm" onclick="refreshData()">
                    <i class="bi bi-arrow-clockwise"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-list-ul me-2"></i>
                            Memory Selection
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="memory-loading" class="text-center">
                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <small class="d-block mt-2 text-muted">Loading memories...</small>
                        </div>
                        <div id="memory-list" class="d-none">
                            <div class="mb-3">
                                <label for="memory-select" class="form-label">Select a Memory:</label>
                                <select id="memory-select" class="form-select">
                                    <option value="">Choose a memory...</option>
                                </select>
                            </div>
                            <div id="memory-info" class="d-none">
                                <small class="text-muted d-block mb-2">Memory Details:</small>
                                <div class="small">
                                    <div><strong>Status:</strong> <span id="memory-status"></span></div>
                                    <div><strong>Created:</strong> <span id="memory-created"></span></div>
                                    <div><strong>Updated:</strong> <span id="memory-updated"></span></div>
                                </div>
                            </div>
                        </div>
                        <div id="memory-error" class="d-none">
                            <div class="alert alert-warning" role="alert">
                                <i class="bi bi-exclamation-triangle me-2"></i>
                                <small>Unable to load memories. Please check your AWS credentials and permissions.</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="col-md-9">
                <!-- Welcome Message -->
                <div id="welcome-message" class="text-center py-5">
                    <i class="bi bi-arrow-left-circle text-white" style="font-size: 3rem; opacity: 0.9;"></i>
                    <h3 class="mt-3 text-white">Welcome to AgentCore Memory Browser</h3>
                    <p class="text-white-50">Please select a memory from the sidebar to begin exploring.</p>
                </div>

                <!-- Memory Details -->
                <div id="memory-details" class="d-none">
                    <!-- Memory Overview -->
                    <div class="card mb-4">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0" id="memory-title">
                                <i class="bi bi-info-circle me-2"></i>
                                Memory Overview
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <i class="bi bi-check-circle-fill text-success" style="font-size: 2rem;"></i>
                                            <h6 class="mt-2">Status</h6>
                                            <span id="detail-status" class="badge bg-success"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <i class="bi bi-calendar-plus text-primary" style="font-size: 2rem;"></i>
                                            <h6 class="mt-2">Created</h6>
                                            <small id="detail-created" class="text-muted"></small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <i class="bi bi-calendar-check text-warning" style="font-size: 2rem;"></i>
                                            <h6 class="mt-2">Updated</h6>
                                            <small id="detail-updated" class="text-muted"></small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="memory-description" class="mt-3 d-none">
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle me-2"></i>
                                    <strong>Description:</strong>
                                    <span id="detail-description"></span>
                                </div>
                            </div>

                            <!-- Memory Metadata Expandable -->
                            <div class="mt-3">
                                <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#memory-metadata">
                                    <i class="bi bi-list-ul me-2"></i>
                                    Memory Metadata
                                </button>
                                <div class="collapse mt-2" id="memory-metadata">
                                    <div class="card card-body bg-light">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <small><strong>ID:</strong>
                                                    <button class="btn btn-outline-secondary btn-sm ms-2 copy-btn"
                                                            data-copy-source="detail-id"
                                                            data-copy-label="Memory ID"
                                                            title="Copy Memory ID">
                                                        <i class="bi bi-clipboard"></i>
                                                    </button>
                                                </small>
                                                <code id="detail-id" class="d-block"></code>
                                            </div>
                                            <div class="col-md-6">
                                                <div id="detail-encryption" class="d-none">
                                                    <small><strong>Encryption Key:</strong></small>
                                                    <code id="detail-encryption-key" class="d-block"></code>
                                                </div>
                                                <div id="detail-execution" class="d-none">
                                                    <small class="mt-2 d-block"><strong>Execution Role:</strong></small>
                                                    <code id="detail-execution-role" class="d-block"></code>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- ARN gets its own full-width row -->
                                        <div class="row mt-2">
                                            <div class="col-12">
                                                <small><strong>ARN:</strong>
                                                    <button class="btn btn-outline-secondary btn-sm ms-2 copy-btn"
                                                            data-copy-source="detail-arn"
                                                            data-copy-label="Memory ARN"
                                                            title="Copy Memory ARN">
                                                        <i class="bi bi-clipboard"></i>
                                                    </button>
                                                </small>
                                                <code id="detail-arn" class="d-block text-break" style="word-break: break-all; font-size: 0.875rem;"></code>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Add Event Section -->
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">
                                <i class="bi bi-plus-circle me-2"></i>
                                Add Event
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="add-event-actor" class="form-label">Actor ID</label>
                                    <input type="text" id="add-event-actor" class="form-control" placeholder="default" value="default">
                                </div>
                                <div class="col-md-6">
                                    <label for="add-event-session" class="form-label">Session ID</label>
                                    <input type="text" id="add-event-session" class="form-control" placeholder="default" value="default">
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="add-event-role" class="form-label">Role</label>
                                    <select id="add-event-role" class="form-select">
                                        <option value="USER" selected>User</option>
                                        <option value="ASSISTANT">Assistant</option>
                                        <option value="TOOL">Tool</option>
                                        <option value="OTHER">Other</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="add-event-type" class="form-label">Content Type</label>
                                    <select id="add-event-type" class="form-select">
                                        <option value="text" selected>Plain Text</option>
                                        <option value="json">JSON</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="add-event-content" class="form-label">Content</label>
                                <textarea id="add-event-content" class="form-control" rows="3" placeholder="Enter content..."></textarea>
                            </div>
                            <div class="mb-3">
                                <button class="btn btn-primary" onclick="executeAddEvent()">
                                    <i class="bi bi-plus-circle me-2"></i>Add Event
                                </button>
                            </div>
                            <div id="add-event-results"></div>
                        </div>
                    </div>

                    <!-- List Events Section -->
                    <div class="card mb-4">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0">
                                <i class="bi bi-calendar-event me-2"></i>
                                List Events
                            </h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">List events for specific sessions and actors. This is a core functionality of AgentCore Memory.</p>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="global-actor-id" class="form-label">Actor ID</label>
                                    <input type="text" id="global-actor-id" class="form-control" placeholder="default" value="default">
                                </div>
                                <div class="col-md-6">
                                    <label for="global-session-id" class="form-label">Session ID</label>
                                    <input type="text" id="global-session-id" class="form-control" placeholder="default" value="default">
                                </div>
                            </div>
                            <div class="mb-3">
                                <button class="btn btn-warning" onclick="executeGlobalListEvents()">
                                    <i class="bi bi-calendar-event me-2"></i>List Events
                                </button>
                            </div>
                            <div id="global-events-results">
                                <!-- Events results will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Memory Strategies -->
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">
                                <i class="bi bi-gear me-2"></i>
                                Memory Strategies
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="strategies-tabs">
                                <!-- Strategy tabs will be dynamically generated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="loading-memory" class="d-none text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3 text-muted">Loading memory details...</p>
                </div>

                <!-- Error State -->
                <div id="error-memory" class="d-none">
                    <div class="alert alert-danger" role="alert">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong>Error loading memory:</strong>
                        <span id="error-message"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JSON Viewer Modal -->
    <div class="modal fade" id="json-viewer-modal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-code-square me-2"></i>
                        JSON Viewer: <span id="json-field-name"></span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="json-editor" style="height: 500px;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="copyJsonToClipboard()">
                        <i class="bi bi-clipboard me-2"></i>
                        Copy to Clipboard
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="delete-confirm-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        Confirm Delete
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="delete-confirm-message">Are you sure you want to delete this item?</p>
                    <p class="text-muted small mb-0">This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" id="delete-confirm-btn" class="btn btn-danger">
                        <i class="bi bi-trash me-2"></i>
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- JSONEditor JS -->
    <script src="https://cdn.jsdelivr.net/npm/jsoneditor@9.10.2/dist/jsoneditor.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="/static/js/app.js?v={{ cache_bust_uuid }}"></script>
</body>
</html>